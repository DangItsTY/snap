<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<title>Snap!</title>
		<link rel="stylesheet" href="styles/styles.css">
		<link rel="manifest" href="manifest.json">
	</head>
	<body class="mobil">
		<main id="container" class="bg-color">
			<section id="background">
			</section>
			<section id="content">
			</section>
			<section id="foreground">
			</section>
			<section id="overlay">
			</section>
			<section id="info">
			</section>
		</main>
		<footer>
		</footer>
		<script src="scripts/core/config.js"></script>
		<script src="scripts/systems/maker.js"></script>
		<script src="scripts/systems/controls/controls_config.js"></script>
		<script src="scripts/systems/controls/controls.js"></script>
		<script src="scripts/systems/controls/abilities.js"></script>
		<script src="scripts/systems/physics.js"></script>
		<script src="scripts/systems/collision.js"></script>
		<script src="scripts/runs/runClean.js"></script>
		<script src="scripts/runs/runActs.js"></script>
		<script src="scripts/render/render.js"></script>
		<script src="scripts/core/game.js"></script>
		<script>
			function initrender() {
				renderInit();
			}
			initrender();
			
			function initialize() {
				initmansion();
			}
			initialize();
			
			function blankField() {
			}
			
			function preload() {
			}
			preload();
			
			function prerender() {
				renderAttach(OBJECTS_BACKGROUND);			
				renderAttach(OBJECTS);
				renderAttach(OBJECTS_FOREGROUND);
			}
			prerender();
			
			function log(label, value) {
				var element = document.getElementById(label);
				if (!element) {
					element = document.createElement('div');
					element.id = label;
					INFO_LAYER.appendChild(element);
				}
				element.innerHTML = label + ": " + value;
			}
			
			var lastTimestamp = null;
			var currentTimestamp = null;
			var deltaTime = null;
			var mod = 0;
			function gameloop(timestamp) {
				currentTimestamp = timestamp;
				deltaTime = currentTimestamp - lastTimestamp;
				
				// if user tabs out, don't change anything
				// this will need to be removed once logic goes to the server
				if (deltaTime > 100) {
					deltaTime = 0; 
				}
				
				mod = deltaTime / 1000;
				log("mod", mod);
				lastTimestamp = currentTimestamp;
				game();
				render(OBJECTS_BACKGROUND);
				render(OBJECTS);
				render(OBJECTS_FOREGROUND);
				//renderHud();
				
				window.requestAnimationFrame(gameloop);
			}
			window.requestAnimationFrame(gameloop);
			
			
			
			
			
			
			
			//	initialization scripts
			function initmansion() {
				// need to create a background layer of objects, they don't collide, may have z parallax property
				/*
				OBJECTS.push(make("basic", {
					name: "foyer",
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT / 2,
					width: 800,
					height: 450
				}));
				*/
				
				for (var i = 0; i < 9; i++) {
					for (var j = 0; j < 17; j++) {
						OBJECTS_BACKGROUND.push(make("basic", {
							name: "paperwall",
							x: j * BLOCK_SIZE,
							y: i * BLOCK_SIZE,
							width: BLOCK_SIZE,
							height: BLOCK_SIZE
						}));
					}
				}
				
				//	red staircase
				for (var i = 0; i < 6; i++) {
					for (var j = 0; j < 4; j++) {
						OBJECTS_BACKGROUND.push(make("basic", {
							name: "redstep",
							x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 1.5) + BLOCK_SIZE * j),
							y: GAME_HEIGHT - ((BLOCK_SIZE * 1.5) + BLOCK_SIZE * i) ,
							width: BLOCK_SIZE,
							height: BLOCK_SIZE
						}));
					}
				}
				
				//	railings
				for (var l = 0; l < 2; l++ ) {
					OBJECTS_BACKGROUND.push(make("basic", {
						name: "stairrailpost",
						x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 2) + (BLOCK_SIZE * 4) * l),
						y: GAME_HEIGHT - (BLOCK_SIZE * 1.5),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
					for (var i = 0; i < 5; i++) {
						OBJECTS_BACKGROUND.push(make("basic", {
							name: "stairrail",
							x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 2) + (BLOCK_SIZE * 4) * l),
							y: GAME_HEIGHT - ((BLOCK_SIZE * 2.5) + BLOCK_SIZE * i),
							width: BLOCK_SIZE,
							height: BLOCK_SIZE
						}));
					}
				}
				
				//	upper floor
				OBJECTS_BACKGROUND.push(make("basic", {
					name: "foyerupperfloor",
					x: GAME_WIDTH / 2 - (BLOCK_SIZE * 7),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7.32),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				OBJECTS_BACKGROUND.push(make("basic", {
					name: "foyerupperfloor",
					x: GAME_WIDTH / 2 + (BLOCK_SIZE * 7),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7.32),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				

				
				
				
				
				
				// for performance testing
				/*
				for (var i = 0; i < 100; i++) {
					OBJECTS.push(make("basic", {
						randomizePosition: true,
						randomizeVelocity: true,
						randomizeColor: true
					}));
				}
				*/
				
				/*
				OBJECTS.push(make("point", {
					width: 25,
					height: 25,
					x: 100,
					y: 300
				}));
				*/
				
				OBJECTS.push(make("enemy", {
					name: "zombie",
					width: BLOCK_SIZE,
					height: BLOCK_SIZE,
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - BLOCK_SIZE
				}));
								
				var newPlayer = make("player", {
					width: BLOCK_SIZE,
					height: BLOCK_SIZE,
					x: GAME_WIDTH / 2 + 1,
					y: GAME_HEIGHT - BLOCK_SIZE
				});
				PLAYER = newPlayer;
				OBJECTS.push(newPlayer);
				
				/*
				OBJECTS.push(make("wall", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - 25
				}));
				*/
				
				/*
				OBJECTS.push(make("wall", {
					x: 500,
					y: GAME_HEIGHT - 25 - BLOCK_SIZE,
					width: 200,
					height: BLOCK_SIZE
				}));
				*/
				
				for (var i = 0; i < 41; i++) {
					OBJECTS.push(make("wall", {
						name: "hardwoodfloor",
						x: i * BLOCK_SIZE,
						y: GAME_HEIGHT - (BLOCK_SIZE / 2),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
				}
				
				//	 left wall
				for (var i = 0; i < 6; i++) {
					OBJECTS.push(make("wall", {
						name: "woodwall",
						x: 0,
						y: (BLOCK_SIZE / 2) + (BLOCK_SIZE * i),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
				}
				
				//	 right wall
				for (var i = 0; i < 6; i++) {
					OBJECTS.push(make("wall", {
						name: "woodwall",
						x: GAME_WIDTH,
						y: BLOCK_SIZE / 2 + (BLOCK_SIZE * i),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
				}
				
				/*
				OBJECTS.push(make("platform", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - (BLOCK_SIZE * 2),
					width: BLOCK_SIZE * 4
				}));
				*/
				
				OBJECTS.push(make("platform", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - (BLOCK_SIZE * 3),
					width: BLOCK_SIZE * 4
				}));
				
				OBJECTS.push(make("platform", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - (BLOCK_SIZE * 4),
					width: BLOCK_SIZE * 4
				}));
				
				OBJECTS.push(make("platform", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - (BLOCK_SIZE * 5),
					width: BLOCK_SIZE * 4
				}));
				
				OBJECTS.push(make("platform", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - (BLOCK_SIZE * 6),
					width: BLOCK_SIZE * 4
				}));
				
				OBJECTS.push(make("platform", {
					x: GAME_WIDTH / 2,
					y: GAME_HEIGHT - (BLOCK_SIZE * 7),
					width: GAME_WIDTH - BLOCK_SIZE,
				}));
				
				/*
				OBJECTS.push(make("item", {
					x: 200,
					y: 300
				}));
				*/
				
				
				
				
				
				
				//	foreground
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "chandalier",
					x: GAME_WIDTH / 2,
					y: BLOCK_SIZE * 3,
					width: BLOCK_SIZE * 2,
					height: BLOCK_SIZE * 2
				}));
				for (var i = 0; i < 2; i++) {
					OBJECTS_FOREGROUND.push(make("basic", {
						name: "chandalierchain",
						x: GAME_WIDTH / 2,
						y: BLOCK_SIZE * i,
						width: BLOCK_SIZE * 2,
						height: BLOCK_SIZE * 2
					}));
				}
				
				//	upper floor left
				for ( var i = 0; i < 5; i++) {
					OBJECTS_FOREGROUND.push(make("basic", {
						name: "foyerupperfloor",
						x: GAME_WIDTH / 2 - (BLOCK_SIZE * 2.5) - (BLOCK_SIZE * i),
						y: GAME_HEIGHT - (BLOCK_SIZE * 7.32),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
				}
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "stairrailpost",
					x: GAME_WIDTH / 2 - (BLOCK_SIZE * 7),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7.47),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "stairrailpost",
					x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 2) + (BLOCK_SIZE * 4) * 0),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7.47),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "stairrail",
					x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 2) + (BLOCK_SIZE * 4) * 0),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				
				//	upper floor right
				for ( var i = 0; i < 5; i++) {
					OBJECTS_FOREGROUND.push(make("basic", {
						name: "foyerupperfloor",
						x: GAME_WIDTH / 2 + (BLOCK_SIZE * 2.5) + (BLOCK_SIZE * i),
						y: GAME_HEIGHT - (BLOCK_SIZE * 7.32),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
				}
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "stairrailpost",
					x: GAME_WIDTH / 2 + (BLOCK_SIZE * 7),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7.47),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "stairrailpost",
					x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 2) + (BLOCK_SIZE * 4) * 1),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7.47),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				OBJECTS_FOREGROUND.push(make("basic", {
					name: "stairrail",
					x: GAME_WIDTH / 2 + (-(BLOCK_SIZE * 2) + (BLOCK_SIZE * 4) * 1),
					y: GAME_HEIGHT - (BLOCK_SIZE * 7),
					width: BLOCK_SIZE,
					height: BLOCK_SIZE
				}));
				
				
				
				
				
				var newCamera = make("camera", {
					mode: "static",
					x: 0,
					y: 0
				});
				OBJECTS.push(newCamera);
				CAMERA = newCamera;
			}
			
			function initbasic() {
				for (var i = 0; i < BLOCKH + 1; i++) {
					for (var j = 0; j < BLOCKW + 1; j++) {
						OBJECTS_BACKGROUND.push(make("basic", {
							name: "paperwall",
							x: j * BLOCK_SIZE,
							y: i * BLOCK_SIZE,
							width: BLOCK_SIZE,
							height: BLOCK_SIZE
						}));
					}
				}
				
				for (var i = 0; i < BLOCKW + 1; i++) {
					OBJECTS.push(make("wall", {
						name: "floor",
						x: i * BLOCK_SIZE,
						y: GAME_HEIGHT - (BLOCK_SIZE / 2),
						width: BLOCK_SIZE,
						height: BLOCK_SIZE
					}));
				}
				
				OBJECTS.push(make("enemy", {
					name: "zombie",
					width: BLOCK_SIZE,
					height: BLOCK_SIZE,
					x: GAME_WIDTH / 2 + 1,
					y: GAME_HEIGHT / 2
				}));
								
				var newPlayer = make("player", {
					width: BLOCK_SIZE,
					height: BLOCK_SIZE,
					x: GAME_WIDTH / 2 + 1,
					y: GAME_HEIGHT / 2
				});
				PLAYER = newPlayer;
				OBJECTS.push(newPlayer);
				
				var newCamera = make("camera", {
					mode: "static",
					x: 0,
					y: 0
				});
				OBJECTS.push(newCamera);
				CAMERA = newCamera;
			}
		</script>
	</body>
</html>